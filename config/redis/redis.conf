###############################################
# FKS Redis Configuration (Hardened)
#
# Notes:
# - Password is supplied via command line --requirepass to allow
#   environment variable substitution (Redis doesn't env-substitute in conf).
# - Dangerous commands are renamed/disabled.
# - Append-only file enabled for durability; RDB snapshots retained.
# - Adjust save policies / maxmemory as needed for production.
###############################################

protected-mode yes
port 6379
bind 0.0.0.0 ::0
timeout 0
tcp-keepalive 300
daemonize no

# Databases
databases 16

# Snapshotting (RDB)
save 900 1
save 300 10
save 60 10000
stop-writes-on-bgsave-error yes
rdbcompression yes
rdbchecksum yes
dbfilename dump.rdb
dir /data

# AOF for better durability
appendonly yes
appendfilename "appendonly.aof"
appendfsync everysec
no-appendfsync-on-rewrite yes
aof-load-truncated yes
aof-use-rdb-preamble yes

# Memory Management (set a policy if you wish to cap memory usage)
# maxmemory 512mb
# maxmemory-policy allkeys-lru

# Security: rename or disable high-risk commands
rename-command FLUSHALL ""
rename-command FLUSHDB ""
rename-command CONFIG ""
rename-command DEBUG ""
rename-command KEYS KEYS_unsafe
rename-command SHUTDOWN SHUTDOWN_maybe

# Modules: (redis-stack image auto-loads modules; nothing to configure here.)

# Slowlog for diagnosis
slowlog-log-slower-than 10000
slowlog-max-len 256

# Latency monitoring
latency-monitor-threshold 100

# ACL: (Optional) Provide an ACL file if you want more granular users.
# aclfile /etc/redis/users.acl

# Logging
loglevel notice
# logfile ""  # empty -> stdout

# Disable cluster features (standalone)
cluster-enabled no

# END OF FILE
