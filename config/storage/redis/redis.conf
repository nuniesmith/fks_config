# =============================================================================
# FKS Trading Systems - Redis Configuration
# Environment: Development
# Version: 7.x Compatible
# =============================================================================

# =============================================================================
# NETWORK CONFIGURATION
# =============================================================================

# Accept connections on all interfaces (0.0.0.0 for Docker)
bind 0.0.0.0
port 6379
tcp-backlog 511
tcp-keepalive 300
timeout 300

# Disable protected mode for development (Docker environment)
protected-mode no

# =============================================================================
# GENERAL CONFIGURATION
# =============================================================================

# Number of databases
databases 16

# Maximum number of connected clients
maxclients 10000

# =============================================================================
# SECURITY CONFIGURATION
# =============================================================================

# Authentication password (environment variable takes precedence)
# Set via REDIS_PASSWORD environment variable in docker-compose
requirepass devpassword

# =============================================================================
# MEMORY MANAGEMENT
# =============================================================================

# Maximum memory usage
maxmemory 256mb

# Memory eviction policy when maxmemory is reached
# allkeys-lru: Remove any key according to the LRU algorithm
maxmemory-policy allkeys-lru

# =============================================================================
# PERSISTENCE CONFIGURATION
# =============================================================================

# RDB Snapshots - Save the DB on disk
# save <seconds> <changes>
save 900 1     # Save if at least 1 key changed in 900 seconds (15 min)
save 300 10    # Save if at least 10 keys changed in 300 seconds (5 min)  
save 60 10000  # Save if at least 10000 keys changed in 60 seconds (1 min)

# RDB file compression and checksums
rdbcompression yes
rdbchecksum yes

# Append Only File (AOF) - More durable persistence
appendonly yes
appendfilename "appendonly.aof"

# AOF fsync policy
# everysec: fsync every second (good compromise between performance and durability)
appendfsync everysec

# =============================================================================
# LOGGING CONFIGURATION
# =============================================================================

# Log level options: debug, verbose, notice, warning
loglevel notice

# Log file path (empty string = stdout, good for Docker)
logfile ""

# =============================================================================
# PERFORMANCE TUNING
# =============================================================================

# Slow query log
slowlog-log-slower-than 10000  # Log queries slower than 10ms
slowlog-max-len 128            # Keep last 128 slow queries

# =============================================================================
# DEVELOPMENT OPTIMIZATIONS
# =============================================================================

# Disable some safety features for development speed
# (Re-enable for production)
stop-writes-on-bgsave-error no
rdbcompression yes

# =============================================================================
# CLIENT OUTPUT BUFFER LIMITS
# =============================================================================

# Client output buffer limits for different client types
# client-output-buffer-limit <class> <hard limit> <soft limit> <soft seconds>
client-output-buffer-limit normal 0 0 0
client-output-buffer-limit replica 256mb 64mb 60
client-output-buffer-limit pubsub 32mb 8mb 60

# =============================================================================
# ADDITIONAL DEVELOPMENT SETTINGS
# =============================================================================

# Enable keyspace notifications for development/debugging
# notify-keyspace-events Ex

# Lua scripting timeout
lua-time-limit 5000

# =============================================================================
# END CONFIGURATION
# =============================================================================